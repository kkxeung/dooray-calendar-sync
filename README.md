# Dooray! Google 캘린더 동기화

Dooray! 캘린더의 일정을 Google 캘린더로 동기화하는 Python 스크립트입니다.

이 스크립트는 단방향 동기화를 수행하여, 선택된 Dooray! 캘린더의 일정을 주 Google 캘린더에 추가합니다. 중복을 방지하기 위해 동기화된 일정을 추적하고 업데이트 및 삭제를 처리합니다.

## 주요 기능

-   **단방향 동기화**: Dooray!에서 Google 캘린더로 일정을 동기화합니다.
-   **지능형 업데이트 및 삭제**: Dooray!에서 이벤트가 변경되거나 삭제되면 Google 캘린더에 반영합니다.
    -   **과거 데이터 보존**: 동기화 기간(현재, 다음 달)에서 벗어난 과거 일정은 실수로 삭제되지 않도록 안전하게 보존됩니다.
-   **기본 알림 비활성화**: Google 캘린더에 생성되는 모든 일정의 기본 알림이 자동으로 비활성화됩니다.
-   **상태 저장 동기화**: 중복 생성을 피하기 위해 동기화된 이벤트를 기억합니다.
-   **대화형 캘린더 선택**: 처음 실행 시 Dooray! 캘린더 목록을 표시하고 동기화할 캘린더를 선택하도록 요청합니다.

## 요구 사항

-   Python 3.6+
-   Google 계정
-   API 토큰이 있는 Dooray! 계정

## 설정

### 1. 필요 라이브러리 설치

```bash
pip install google-api-python-client google-auth-oauthlib google-auth-httplib2 requests
```

### 2. Google 캘린더 API 구성

1.  [Google Cloud Console](https://console.cloud.google.com/)로 이동합니다.
2.  새 프로젝트를 만듭니다.
3.  **Google Calendar API**를 활성화합니다.
4.  **데스크톱 앱**용 **OAuth 2.0 클라이언트 ID**를 만듭니다.
5.  JSON 자격 증명 파일을 다운로드하여 스크립트와 동일한 디렉토리에 `credentials.json`으로 저장합니다.

### 3. Dooray! API 구성

1.  동일한 디렉토리에 `dooray_api_key.txt`라는 파일을 만듭니다.
2.  이 파일에 Dooray! API 토큰을 붙여넣습니다.

## 사용법

1.  터미널에서 스크립트를 실행합니다:
    ```bash
    python sync_calendar.py
    ```

2.  **첫 실행**:
    -   웹 브라우저가 열리고 Google 계정에 로그인하여 권한을 부여하라는 메시지가 표시됩니다.
    -   인증 후, 다음 실행을 위해 자격 증명을 저장하는 `token.json` 파일이 생성됩니다.
    -   Dooray! 캘린더 목록이 표시됩니다. 동기화하려는 캘린더에 해당하는 번호를 입력합니다.
    -   선택 사항은 `config.json`에 저장됩니다.

3.  **이후 실행**:
    -   스크립트는 `config.json`에 저장된 캘린더 ID를 자동으로 사용합니다.
    -   다른 캘린더를 동기화하려면 `config.json` 파일을 삭제하고 스크립트를 다시 실행하십시오.

## 자동 실행 (Windows)

Windows의 **작업 스케줄러**를 사용하여 이 스크립트를 주기적으로 실행할 수 있습니다.

1.  **작업 스케줄러 열기**:
    *   Windows 검색창에 `작업 스케줄러`를 입력하고 실행합니다.

2.  **기본 작업 만들기**:
    *   오른쪽 **작업** 창에서 **"기본 작업 만들기..."**를 클릭합니다.
    *   **이름**과 **설명**을 입력합니다 (예: `Dooray 캘린더 동기화`).

3.  **트리거 설정**:
    *   작업을 시작할 주기를 선택합니다 (예: **매일**).
    *   시작 날짜와 시간을 설정합니다.
    *   **"작업 속성 대화 상자 열기"**에 체크하고 **마침**을 클릭합니다.

4.  **반복 간격 설정**:
    *   속성 창이 열리면 **트리거** 탭으로 이동하여 현재 트리거를 선택하고 **편집**을 클릭합니다.
    *   **작업 반복 간격**을 체크하고 원하는 간격(예: `1분`)과 기간(예: `무기한`)을 설정합니다.
    *   **참고**: 너무 잦은 동기화는 API 사용량 제한에 도달할 수 있으니 `5분` 또는 `10분` 간격으로 설정하는 것을 권장합니다.

5.  **동작 설정**:
    *   **동작** 탭으로 이동하여 **새로 만들기**를 클릭합니다.
    *   **동작**은 **"프로그램 시작"**으로 설정합니다.
    *   **프로그램/스크립트**: `python.exe`의 전체 경로를 입력합니다. (경로를 모를 경우, 명령 프롬프트에서 `where python` 명령으로 찾을 수 있습니다.)
        *   **팁**: CMD 창이 뜨는 것을 원치 않으면, `python.exe` 대신 `pythonw.exe`를 사용하세요. `pythonw.exe`는 콘솔 창 없이 스크립트를 실행합니다.
    *   **인수 추가**: `sync_calendar.py`를 입력합니다.
    *   **시작 위치**: 스크립트가 있는 폴더의 전체 경로를 입력합니다 (예: `C:\Users\YourUser\dooray-calendar-sync`).

6.  **마침**:
    *   **확인**을 눌러 모든 설정을 저장합니다. 이제 스크립트가 설정된 간격으로 자동 실행됩니다.

## 작동 방식

스크립트는 현재 및 다음 달에 대해 선택된 Dooray! 캘린더에서 이벤트를 가져옵니다. 그런 다음 이 이벤트를 `sync_state.json`에 저장된 이전에 동기화된 이벤트 목록과 비교합니다.

-   **새 이벤트**는 Google 캘린더에 추가됩니다.
-   **변경된 이벤트**는 Google 캘린더에서 업데이트됩니다.
-   **삭제된 이벤트**는 Google 캘린더에서 제거됩니다.

이를 통해 Google 캘린더가 Dooray! 캘린더와 최신 상태를 유지하도록 합니다.

## 문제 해결

-   **`FileNotFoundError: [Errno 2] No such file or directory: 'credentials.json'`**: Google Cloud Console에서 자격 증명 파일을 다운로드하여 올바른 디렉토리에 `credentials.json`으로 저장했는지 확인하십시오.
-   **`Error: dooray_api_key.txt not found`**: `dooray_api_key.txt` 파일을 만들고 그 안에 API 토큰을 넣었는지 확인하십시오.
-   **인증 문제**: Google 인증에 문제가 있는 경우 `token.json` 파일을 삭제하고 스크립트를 다시 실행하여 다시 인증해 보십시오.
-   **잘못된 캘린더 동기화**: 잘못된 캘린더가 동기화되는 경우 `config.json`을 삭제하여 캘린더를 다시 선택하라는 메시지가 표시되도록 하십시오.
-   **작업 스케줄러가 실행되지 않을 때**:
    *   **동작** 탭의 `시작 위치` 경로가 올바르게 설정되었는지 확인하세요.
    *   **조건** 탭에서 "컴퓨터의 AC 전원이 켜져 있는 경우에만 작업 시작" 옵션을 해제하여 노트북이 배터리로 작동할 때도 실행되도록 할 수 있습니다.